import{a as A,r as v,d as L,u as T,o as j,b as E,c as P,w as B,e as h,f as y,g as e,t as f,h as p,i as g,v as x,j as F,q as U,m as I,F as R,n as V,p as S}from"./index-SHNmtPve.js";import{M as z,_ as G}from"./DeleteModal.vue_vue_type_script_setup_true_lang-BrKoz3V2.js";const q="https://ec-course-api.hexschool.io",D="raychen",C=A.create({baseURL:q});C.interceptors.request.use(o=>{const i=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return i&&(o.headers.Authorization=i),o},o=>Promise.reject(o));C.interceptors.response.use(o=>Promise.resolve(o),o=>Promise.reject(o.response.data));const H=o=>C.get(`/v2/api/${D}/admin/coupons`,{params:o}),O=o=>C.post(`/v2/api/${D}/admin/coupon`,{data:o}),J=o=>{const{data:i,id:b}=o;return C.put(`/v2/api/${D}/admin/coupon/${b}`,{data:i})},K=o=>C.delete(`/v2/api/${D}/admin/coupon/${o}`),N=()=>({id:"",title:"",code:"",percent:0,due_date:Math.floor(Date.now()/1e3),is_enabled:1,num:0});function Q(){const o=v(N()),i=v("新增優惠券"),b=m=>{m?(o.value={...m},i.value="編輯優惠券"):a()},a=()=>{o.value=N(),i.value="新增優惠券"};return{form:o,formTitle:i,loadCoupon:b,resetForm:a}}const W={class:"modal-dialog modal-dialog-centered"},X={class:"modal-content rounded-lg"},Y={class:"modal-header"},Z={class:"modal-title",id:"addNewCouponModalLabel"},ee={class:"modal-body"},te={class:"mb-3"},oe={class:"mb-3"},ne={class:"mb-3"},le={class:"mb-3"},se={class:"mb-3"},ae={class:"mb-3 d-flex align-items-center"},de={class:"form-check form-switch"},ie={class:"modal-footer"},ue=["disabled"],re=L({__name:"CouponModal",props:{coupon:{}},emits:["get-coupons"],setup(o,{expose:i,emit:b}){const a=b,m=T("modalRef");let d=null;j(()=>{m.value&&(d=new z(m.value))}),E(()=>{d&&d.dispose()});const _=()=>{d&&d.show()},k=()=>{d&&d.hide()},{form:s,formTitle:$,loadCoupon:M}=Q(),w=P({get:()=>s.value.due_date?new Date(s.value.due_date*1e3).toISOString().slice(0,16):"",set:u=>{s.value.due_date=Math.floor(new Date(u).getTime()/1e3)}});B(()=>o.coupon,u=>{u&&u.id?M(u):M(null)},{immediate:!0,deep:!0});const r=P(()=>!!o.coupon?.id),l=v(!1),n=async()=>{const{id:u,...t}=s.value;l.value=!0;try{r.value&&u?await J({data:t,id:u}):await O(t),k()}catch{alert("新增/編輯優惠券失敗")}finally{l.value=!1,a("get-coupons")}};return i({openModal:_,closeModal:k}),(u,t)=>(y(),h("div",{ref_key:"modalRef",ref:m,class:"modal fade",id:"addNewCouponModal",tabindex:"-1","aria-labelledby":"addNewCouponModalLabel","aria-hidden":"true"},[e("div",W,[e("div",X,[e("div",Y,[e("h5",Z,f(p($)),1),e("button",{onClick:k,type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]),e("div",ee,[e("form",null,[e("div",te,[t[6]||(t[6]=e("label",{for:"couponTitle",class:"form-label"},"優惠券名稱",-1)),g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>p(s).title=c),type:"text",class:"form-control rounded-lg",id:"couponTitle"},null,512),[[x,p(s).title]])]),e("div",oe,[t[7]||(t[7]=e("label",{for:"couponCode",class:"form-label"},"優惠券代碼",-1)),g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>p(s).code=c),type:"text",class:"form-control rounded-lg",id:"couponCode"},null,512),[[x,p(s).code]])]),e("div",ne,[t[8]||(t[8]=e("label",{for:"couponPercent",class:"form-label"},"折扣百分比",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=c=>p(s).percent=c),type:"number",class:"form-control rounded-lg",id:"couponPercent",min:"0",max:"100"},null,512),[[x,p(s).percent]])]),e("div",le,[t[9]||(t[9]=e("label",{for:"couponDueDate",class:"form-label"},"到期日",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=c=>w.value=c),type:"datetime-local",class:"form-control rounded-lg",id:"couponDueDate"},null,512),[[x,w.value]])]),e("div",se,[t[10]||(t[10]=e("label",{for:"couponNum",class:"form-label"},"使用次數",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=c=>p(s).num=c),type:"number",class:"form-control rounded-lg",id:"couponNum",min:"0"},null,512),[[x,p(s).num]])]),e("div",ae,[t[11]||(t[11]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",de,[g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=c=>p(s).is_enabled=c),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"flexSwitchCouponEnable"},null,512),[[F,p(s).is_enabled]])])])])]),e("div",ie,[e("button",{onClick:k,type:"button",class:"btn btn-outline-secondary rounded-lg"}," 取消 "),e("button",{onClick:n,disabled:l.value,type:"button",class:"btn btn-dark rounded-lg"}," 儲存 ",8,ue)])])])],512))}}),ce={class:"d-flex justify-content-end align-items-center mb-4"},pe={class:"card shadow-sm rounded-lg flex-grow-1"},me={class:"card-body p-4"},be={class:"table-responsive"},fe={class:"table table-hover align-middle"},ve={class:"text-center"},_e={class:"form-check form-switch d-flex justify-content-center align-items-center"},ge=["checked"],he={class:"text-nowrap"},ye=["onClick"],Ce=["onClick"],ke={class:"d-flex justify-content-center mt-4"},xe={class:"pagination"},$e={class:"page-item"},Me=["disabled"],we={class:"page-item"},De=["onClick","disabled"],Re={class:"page-item"},Se=["disabled"],Ue=L({__name:"CouponManagement",setup(o){const i=T("couponModalRef"),b=T("deleteModalRef"),a=v("1"),m=v([]),d=v({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),_=async()=>{try{const r=await H({page:a.value});m.value=r.data.coupons,d.value=r.data.pagination}catch{alert("取得優惠券列表失敗")}};j(()=>{_()}),B(a,_);const s=v({id:"",title:"",code:"",percent:0,due_date:Math.floor(Date.now()/1e3),is_enabled:1,num:0}),$=(r=null)=>{r&&(s.value={...r}),i.value?.openModal()},M=r=>{b.value?.openModal(()=>w(r))},w=async r=>{try{await K(r)}catch{alert("刪除優惠券失敗")}finally{_()}};return(r,l)=>(y(),h(R,null,[e("div",ce,[e("button",{onClick:l[0]||(l[0]=n=>$(null)),type:"button",class:"btn btn-dark rounded-lg px-4 py-2"},[...l[3]||(l[3]=[e("i",{class:"fas fa-plus me-2"},null,-1),I("新增優惠券 ",-1)])])]),e("div",pe,[e("div",me,[e("div",be,[e("table",fe,[l[4]||(l[4]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠券代碼"),e("th",{scope:"col"},"折扣百分比"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"使用次數"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(y(!0),h(R,null,V(m.value,n=>(y(),h("tr",{key:n.id},[e("td",null,f(n.title),1),e("td",null,f(n.code),1),e("td",null,f(n.percent)+"%",1),e("td",null,f(new Date(n.due_date*1e3).toLocaleDateString()),1),e("td",null,f(n.num),1),e("td",ve,[e("div",_e,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!n.is_enabled},null,8,ge)])]),e("td",he,[e("button",{onClick:u=>$(n),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 編輯 ",8,ye),e("button",{onClick:u=>M(n.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,Ce)])]))),128))])])]),e("nav",ke,[e("ul",xe,[e("li",$e,[e("button",{onClick:l[1]||(l[1]=n=>a.value=String(Number(a.value)-1)),disabled:!d.value?.has_pre,type:"button",class:S(["page-link",{disabled:!d.value?.has_pre}]),"aria-label":"Previous"},[...l[5]||(l[5]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,Me)]),(y(!0),h(R,null,V(d.value?.total_pages,n=>(y(),h("li",we,[e("button",{onClick:u=>a.value=n.toString(),disabled:a.value===n.toString(),type:"button",class:S(["page-link",{active:a.value===n.toString()}])},f(n),11,De)]))),256)),e("li",Re,[e("button",{onClick:l[2]||(l[2]=n=>a.value=String(Number(a.value)+1)),disabled:!d.value?.has_next,class:S(["page-link",{disabled:!d.value?.has_next}]),type:"button","aria-label":"Next"},[...l[6]||(l[6]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,Se)])])])])]),U(re,{ref_key:"couponModalRef",ref:i,coupon:s.value,onGetCoupons:_},null,8,["coupon"]),U(G,{ref_key:"deleteModalRef",ref:b,title:"刪除優惠券",content:"確定要刪除該優惠券嗎？"},null,512)],64))}});export{Ue as default};
